{% extends 'sgea_app/base.html' %}

{% block title %}Gerenciar Participantes - {{ evento.nome }}{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div>
            <h1 style="margin-bottom: 5px;"><i class="fas fa-users-cog"></i> Gestão de Participantes</h1>
            <h3 style="color: #666; font-weight: normal; font-size: 1.1rem;">Evento: <strong>{{ evento.nome }}</strong></h3>
        </div>
        <div style="text-align: right;">
            <span style="background: var(--bg-color); padding: 5px 10px; border-radius: 4px; border: 1px solid #ddd;">
                Total: <strong>{{ inscricoes.count }}</strong> inscritos
            </span>
        </div>
    </div>

    {% if inscricoes %}
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Participante</th>
                        <th>Instituição</th>
                        <th>Data Inscrição</th>
                        <th style="text-align: center;">Presença</th>
                        <th style="text-align: center;">Certificado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for inscricao in inscricoes %}
                    <tr>
                        <td>
                            <strong>{{ inscricao.usuario.first_name }} {{ inscricao.usuario.last_name }}</strong><br>
                            <small style="color: #666;">{{ inscricao.usuario.email }}</small>
                        </td>
                        <td>{{ inscricao.usuario.instituicao_ensino|default:"-" }}</td>
                        <td>{{ inscricao.data_inscricao|date:"d/m/Y" }}</td>

                        <td style="text-align: center;">
                            {% if inscricao.certificado %}
                                <span style="color: var(--success); font-weight: bold;">
                                    <i class="fas fa-check-double"></i> Confirmada
                                </span>
                            {% else %}
                                <a href="{% url 'marcar_presenca' inscricao.pk %}" 
                                   class="btn {% if inscricao.presenca %}btn-success{% else %}btn-secondary{% endif %}"
                                   style="padding: 5px 10px; font-size: 0.8rem; width: 100px;">
                                    {% if inscricao.presenca %}
                                        <i class="fas fa-check"></i> Presente
                                    {% else %}
                                        <i class="fas fa-times"></i> Ausente
                                    {% endif %}
                                </a>
                            {% endif %}
                        </td>

                        <td style="text-align: center;">
                            {% if inscricao.certificado %}
                                <div style="color: var(--success);">
                                    <i class="fas fa-certificate"></i> Emitido<br>
                                    <small style="font-family: monospace;">{{ inscricao.certificado.codigo_validacao }}</small>
                                </div>
                            {% else %}
                                {% if inscricao.presenca %}
                                    <span style="color: var(--secondary-color); font-weight: bold; font-size: 0.9rem;">
                                        <i class="fas fa-hourglass-half"></i> Aguardando<br>Fim do Evento
                                    </span>
                                {% else %}
                                    <span style="color: #999; font-style: italic;">Pendente</span>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px; background: #f9f9f9; border-radius: 8px;">
            <p style="color: #666; font-size: 1.2rem;">Nenhum participante se inscreveu neste evento ainda.</p>
        </div>
    {% endif %}

    <div style="margin-top: 30px;">
        <a href="{% url 'organizador_dashboard' %}" class="btn btn-secondary">
            &larr; Voltar para o Dashboard
        </a>
    </div>
</div>
{% endblock %}