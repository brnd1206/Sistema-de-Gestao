{% extends 'sgea_app/base.html' %}

{% block title %}Painel do Aluno - UniEvents{% endblock %}

{% block content %}

{% if user.perfil == 'professor' %}
<div class="card">
    <h2 style="color: var(--primary-color); border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px;">
        <i class="fas fa-chalkboard-teacher"></i> Eventos sob Minha Responsabilidade
    </h2>
    {% if eventos_responsavel %}
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Evento</th>
                        <th>Local</th>
                        <th>Período</th>
                        <th>Ocupação</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for evento in eventos_responsavel %}
                    <tr>
                        <td><strong>{{ evento.nome }}</strong></td>
                        <td>{{ evento.local }}</td>
                        <td>{{ evento.data_inicio|date:"d/m" }} - {{ evento.data_fim|date:"d/m" }}</td>
                        <td>{{ evento.participantes.count }} / {{ evento.quantidade_participantes }}</td>
                        <td>
                            <a href="{% url 'detalhes_evento' evento.pk %}" class="btn btn-primary" style="padding: 5px 15px; font-size: 0.9rem;">Ver</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="color: #666;">Você não é responsável por nenhum evento no momento.</p>
    {% endif %}
</div>
{% endif %}

<div class="card">
    <h2><i class="fas fa-user-check"></i> Minhas Inscrições</h2>
    {% if eventos_inscritos %}
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Evento</th>
                        <th>Data e Hora</th>
                        <th>Local</th>
                        <th style="text-align: right;">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for evento in eventos_inscritos %}
                    <tr>
                        <td><strong>{{ evento.nome }}</strong></td>
                        <td>{{ evento.data_inicio|date:"d/m/Y H:i" }}</td>
                        <td>{{ evento.local }}</td>
                        <td style="text-align: right;">
                            <a href="{% url 'detalhes_evento' evento.pk %}" class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem; margin-right: 5px;">
                                <i class="fas fa-info-circle"></i> Detalhes
                            </a>
                            <form action="{% url 'cancelar_inscricao' evento.pk %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;">
                                    <i class="fas fa-times"></i> Sair
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="font-style: italic; color: #777;">Você ainda não se inscreveu em nenhum evento.</p>
    {% endif %}
</div>

<div class="card">
    <h2><i class="fas fa-search-plus"></i> Eventos Disponíveis</h2>
    {% if eventos_disponiveis %}
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Evento</th>
                        <th>Início</th>
                        <th>Local</th>
                        <th style="text-align: right;">Ação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for evento in eventos_disponiveis %}
                    <tr>
                        <td>
                            <strong>{{ evento.nome }}</strong><br>
                            <small>{{ evento.get_tipo_evento_display }}</small>
                        </td>
                        <td>{{ evento.data_inicio|date:"d/m/Y H:i" }}</td>
                        <td>{{ evento.local }}</td>
                        <td style="text-align: right;">
                            <form action="{% url 'inscrever_evento' evento.pk %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success" style="padding: 8px 15px; font-size: 0.9rem;">
                                    <i class="fas fa-pen"></i> Inscrever-se
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="font-style: italic; color: #777;">Não há novos eventos disponíveis para inscrição no momento.</p>
    {% endif %}
</div>

<div class="card">
    <h2><i class="fas fa-certificate"></i> Meus Certificados</h2>
    {% if certificados_obtidos %}
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Evento</th>
                        <th>Data Emissão</th>
                        <th>Código de Validação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for certificado in certificados_obtidos %}
                    <tr>
                        <td>{{ certificado.inscricao.evento.nome }}</td>
                        <td>{{ certificado.data_emissao|date:"d/m/Y" }}</td>
                        <td>
                            <span style="font-family: monospace; background: #eee; padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc;">
                                {{ certificado.codigo_validacao }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="font-style: italic; color: #777;">Você ainda não possui certificados emitidos.</p>
    {% endif %}
</div>

{% endblock %}